[{"$match":{"Issuer":{"$ne":"NULL"},"Status":{"$eq":"DONE"}}},{"$group":{"_id":"","int":{"$addToSet":"$CounterParty"},"isr":{"$addToSet":"$Issuer"},"nwd":{"$max":"$DateInt"},"odd":{"$min":"$DateInt"},"sct":{"$addToSet":"$ISIN"},"trx":{"$sum":1},"vol":{"$sum":"$value_ori"}}},{"$project":{"_id":0,"inv":{"$size":"$int"},"iss":{"$size":"$isr"},"new":{"$concat":[{"$substr":["$nwd",0,4]},"/",{"$substr":["$nwd",4,2]},"/",{"$substr":["$nwd",6,2]}]},"old":{"$concat":[{"$substr":["$odd",0,4]},"/",{"$substr":["$odd",4,2]},"/",{"$substr":["$odd",6,2]}]},"sec":{"$size":"$sct"},"trx":1,"vol":1}}]
